# GitHub Actions CI for 4YP Assessment Timetable Scheduler
#
# Three jobs:
#   lint   — ruff checks style (F401, E, W, etc.)
#   test   — pytest full test suite
#   types  — pyright static type check
#
# tkinter note: ubuntu-latest does not ship python3-tk by default.
# We install it via apt before running tests or type checks that
# import any schedule_app.ui_tk module.

name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  lint:
    name: Lint (ruff)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install ruff
        run: pip install "ruff>=0.6"

      - name: Run ruff
        run: ruff check src/ tests/ main.py

  test:
    name: Tests (pytest)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install tkinter (required by schedule_app.ui_tk)
        run: sudo apt-get install -y python3-tk

      - name: Install project dependencies
        run: pip install -e ".[dev]"

      - name: Run pytest
        run: pytest tests/ -v --tb=short

  types:
    name: Type check (pyright)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install tkinter (required to resolve ui_tk imports)
        run: sudo apt-get install -y python3-tk

      - name: Install project dependencies
        run: pip install -e ".[dev]" pyright

      - name: Run pyright
        run: pyright src/schedule_app/
